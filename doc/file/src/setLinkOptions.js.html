<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/setLinkOptions.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a data-ice="repoURL" href="https://github.com/Madadata/hasoop" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/index.js~Hasoop.html">Hasoop</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-senDeleteRequest">senDeleteRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-senPostRequest">senPostRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-senPutRequest">senPutRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sendGetRequest">sendGetRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setCreateJobRequestBody">setCreateJobRequestBody</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setUpdateJobRequestBody">setUpdateJobRequestBody</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setCreateLinkRequestBody">setCreateLinkRequestBody</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setUpdateLinkRequestBody">setUpdateLinkRequestBody</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-splitJobConfig">splitJobConfig</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-splitLinkConfig">splitLinkConfig</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-connectorType">connectorType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-genericType">genericType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-linkType">linkType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-version">version</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/setLinkOptions.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
 * Created by Chyroc on 17/1/11.
 */

import _ from &apos;lodash&apos;

import { linkType } from &apos;./index&apos;

function setCreateLinkRequestMainBody (linkName, connectorName) {
  return {
    &apos;id&apos;: -1,
    &apos;name&apos;: linkName,
    &apos;connector-name&apos;: connectorName,
    &apos;enabled&apos;: true,
    &apos;creation-date&apos;: Date.now(),
    &apos;creation-user&apos;: null,
    &apos;update-user&apos;: null,
    &apos;update-date&apos;: Date.now()
  }
}
function setCreateLinkRequestMysqlBody (jdbcDriver, connectionString, fetchSize, identifierEnclose, linkConfig) {
  return {
    &apos;link-config-values&apos;: {
      &apos;configs&apos;: [
        {
          &apos;validators&apos;: [],
          &apos;inputs&apos;: [
            {
              &apos;size&apos;: 128,
              &apos;editable&apos;: &apos;ANY&apos;,
              &apos;validators&apos;: [],
              &apos;name&apos;: &apos;linkConfig.jdbcDriver&apos;,
              &apos;id&apos;: 67,
              &apos;sensitive&apos;: false,
              &apos;overrides&apos;: &apos;&apos;,
              &apos;type&apos;: &apos;STRING&apos;,
              &apos;value&apos;: jdbcDriver
            }, {
              &apos;size&apos;: 2000,
              &apos;editable&apos;: &apos;ANY&apos;,
              &apos;validators&apos;: [],
              &apos;name&apos;: &apos;linkConfig.connectionString&apos;,
              &apos;id&apos;: 68,
              &apos;sensitive&apos;: false,
              &apos;overrides&apos;: &apos;&apos;,
              &apos;type&apos;: &apos;STRING&apos;,
              &apos;value&apos;: encodeURIComponent(connectionString)
            }, {
              &apos;size&apos;: 40,
              &apos;editable&apos;: &apos;ANY&apos;,
              &apos;validators&apos;: [],
              &apos;name&apos;: &apos;linkConfig.username&apos;,
              &apos;id&apos;: 69,
              &apos;sensitive&apos;: false,
              &apos;overrides&apos;: &apos;&apos;,
              &apos;type&apos;: &apos;STRING&apos;,
              &apos;value&apos;: linkConfig.username
            }, {
              &apos;size&apos;: 40,
              &apos;editable&apos;: &apos;ANY&apos;,
              &apos;validators&apos;: [],
              &apos;name&apos;: &apos;linkConfig.password&apos;,
              &apos;id&apos;: 70,
              &apos;sensitive&apos;: true,
              &apos;overrides&apos;: &apos;&apos;,
              &apos;type&apos;: &apos;STRING&apos;,
              &apos;value&apos;: linkConfig.password
            }, {
              &apos;editable&apos;: &apos;ANY&apos;,
              &apos;validators&apos;: [],
              &apos;name&apos;: &apos;linkConfig.fetchSize&apos;,
              &apos;id&apos;: 71,
              &apos;sensitive&apos;: false,
              &apos;overrides&apos;: &apos;&apos;,
              &apos;type&apos;: &apos;INTEGER&apos;,
              &apos;value&apos;: `${fetchSize}`
            }, {
              &apos;editable&apos;: &apos;ANY&apos;,
              &apos;validators&apos;: [],
              &apos;name&apos;: &apos;linkConfig.jdbcProperties&apos;,
              &apos;id&apos;: 72,
              &apos;sensitive&apos;: false,
              &apos;overrides&apos;: &apos;&apos;,
              &apos;type&apos;: &apos;MAP&apos;,
              &apos;sensitive-pattern&apos;: &apos;&apos;
            }
          ],
          &apos;name&apos;: &apos;linkConfig&apos;,
          &apos;id&apos;: 17,
          &apos;type&apos;: &apos;LINK&apos;
        },
        {
          &apos;validators&apos;: [],
          &apos;inputs&apos;: [
            {
              &apos;size&apos;: 5,
              &apos;editable&apos;: &apos;ANY&apos;,
              &apos;validators&apos;: [],
              &apos;name&apos;: &apos;dialect.identifierEnclose&apos;,
              &apos;id&apos;: 73,
              &apos;sensitive&apos;: false,
              &apos;overrides&apos;: &apos;&apos;,
              &apos;type&apos;: &apos;STRING&apos;,
              &apos;value&apos;: encodeURIComponent(identifierEnclose)
            }
          ],
          &apos;name&apos;: &apos;dialect&apos;,
          &apos;id&apos;: 18,
          &apos;type&apos;: &apos;LINK&apos;
        }
      ],
      &apos;validators&apos;: []
    }
  }
}

function setCreateLinkRequestHdfsBody (linkConfig) {
  const body = {
    &apos;link-config-values&apos;: {
      &apos;configs&apos;: [
        {
          &apos;validators&apos;: [],
          &apos;inputs&apos;: [
            {
              &apos;size&apos;: 255,
              &apos;editable&apos;: &apos;ANY&apos;,
              &apos;validators&apos;: [],
              &apos;name&apos;: &apos;linkConfig.uri&apos;,
              &apos;id&apos;: 52,
              &apos;sensitive&apos;: false,
              &apos;overrides&apos;: &apos;&apos;,
              &apos;type&apos;: &apos;STRING&apos;,
              &apos;value&apos;: encodeURIComponent(linkConfig.uri)
            }, {
              &apos;size&apos;: 255,
              &apos;editable&apos;: &apos;ANY&apos;,
              &apos;validators&apos;: [],
              &apos;name&apos;: &apos;linkConfig.confDir&apos;,
              &apos;id&apos;: 53,
              &apos;sensitive&apos;: false,
              &apos;overrides&apos;: &apos;&apos;,
              &apos;type&apos;: &apos;STRING&apos;
            }, {
              &apos;editable&apos;: &apos;ANY&apos;,
              &apos;validators&apos;: [],
              &apos;name&apos;: &apos;linkConfig.configOverrides&apos;,
              &apos;id&apos;: 54,
              &apos;sensitive&apos;: false,
              &apos;overrides&apos;: &apos;&apos;,
              &apos;type&apos;: &apos;MAP&apos;,
              // &apos;value&apos;: {&apos;key&apos;: &apos;value&apos;}, TODO
              &apos;sensitive-pattern&apos;: &apos;&apos;
            }
          ],
          &apos;name&apos;: &apos;linkConfig&apos;,
          &apos;id&apos;: 13,
          &apos;type&apos;: &apos;LINK&apos;
        }
      ],
      &apos;validators&apos;: []
    }
  }
  if (linkConfig.maps) {
    _.set(body, &apos;link-config-values.configs[0].inputs[2].value&apos;, linkConfig.maps)
  }
  return body
}

function setCreateMysqlLinkRequestBody (linkConfig) {
  const fetchSize = linkConfig.fetchSize || 1000
  const identifierEnclose = linkConfig.identifierEnclose || &apos;`&apos;
  const port = linkConfig.port || 3306
  const connectorName = &apos;generic-jdbc-connector&apos;
  const jdbcDriver = &apos;com.mysql.jdbc.Driver&apos;
  const connectionString = `jdbc:mysql://${linkConfig.host}:${port}/${linkConfig.databaseName}`
  const mainBody = setCreateLinkRequestMainBody(linkConfig.linkName, connectorName)
  const mysqlBody = setCreateLinkRequestMysqlBody(jdbcDriver, connectionString, fetchSize, identifierEnclose, linkConfig)
  return {&apos;links&apos;: [{...mainBody, ...mysqlBody}]}
}

function setCreateHdfsLinkRequestBody (linkConfig) {
  const connectorName = &apos;hdfs-connector&apos;
  const mainBody = setCreateLinkRequestMainBody(linkConfig.linkName, connectorName)
  const hdfsBody = setCreateLinkRequestHdfsBody(linkConfig)
  const createHdfsLinkBody = {&apos;links&apos;: [{...mainBody, ...hdfsBody}]}
  if (linkConfig.hadoopConfDir) {
    _.set(createHdfsLinkBody, &apos;links[0].link-config-values.configs[0].inputs[1].value&apos;, encodeURIComponent(linkConfig.hadoopConfDir))
  }
  return createHdfsLinkBody
}

export function setCreateLinkRequestBody (linkConfig) {
  if (linkConfig.linkType === linkType.mysql) {
    return setCreateMysqlLinkRequestBody(linkConfig)
  } else if (linkConfig.linkType === linkType.hdfs) {
    return setCreateHdfsLinkRequestBody(linkConfig)
  } else {
    throw new Error(&apos;linkType must be mysql or hdfs&apos;)
  }
}

export function setUpdateLinkRequestBody (linkConfig) {
  return setCreateLinkRequestBody(linkConfig)
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
